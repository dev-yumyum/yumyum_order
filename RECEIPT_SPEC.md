# 영수증 출력 사양서

## 개요
냠냠픽업 주문 관리 시스템의 영수증 출력 기능에 대한 상세 사양서입니다.

## 영수증 구성

### 1. 헤더
- **가게명**: "냠냠픽업" (중앙 정렬, 굵은 글씨, 20pt)

### 2. 주문 정보
- **주문번호**: 당일 주문 순서 (1번부터 시작)
  - 매일 자정 이후 첫 주문부터 1번으로 초기화
  - 예: "주문번호: 21"

### 3. 주문 일시
- **주문일자**: YYYY-MM-DD 형식
- **주문시간**: HH:MM:SS 형식 (초 단위까지 표시)
  - 예: "2025-10-30 08:43:42"

### 4. 고객 정보
- **고객명**: 풀네임 (마스킹 없음)
  - 예: "홍길동"
- **연락처**: 중간 4자리 마스킹 처리
  - 010-1234-5678 → 010-****-5678
  - 02-123-4567 → 02-****-4567
- **주문유형**: 포장/매장/배달

### 5. 주문 메뉴
- 메뉴명, 수량, 가격 표시
- 형식:
  ```
  아메리카노 (L)          x1       4,000원
  ```

### 6. 요청사항
- 고객 요청사항이 있는 경우 표시
- 구분 라인으로 구분
- 요청사항이 없으면 해당 섹션 생략

### 7. 예상 완료시간
- **계산 방식**: 주문시간 + 접수시 설정한 준비시간
- **예시**:
  - 주문시간: 15:30:30
  - 준비시간: 15분
  - 예상 완료시간: 15:45:30
- **표시 형식**: HH:MM:SS (초 단위까지)
- **스타일**: 노란색 배경 강조

### 8. 합계
- 총 주문 금액 표시
- 굵은 글씨로 강조

### 9. 푸터
- **감사 메시지**: "{고객명}님 냠냠픽업을 주문해주셔서 감사합니다"
  - 예: "홍길동님 냠냠픽업을 주문해주셔서 감사합니다"

## 기술 사양

### 출력 크기
- **용지 크기**: 80mm (영수증 프린터 표준)
- **여백**: 10mm

### 폰트
- **기본 폰트**: 맑은 고딕 (Malgun Gothic)
- **기본 크기**: 12pt
- **제목**: 20pt (가게명)
- **강조**: 14pt (주문번호, 합계)

### 색상
- **기본**: 검정색
- **예상 완료시간 배경**: #fff3cd (노란색)
- **예상 완료시간 테두리**: #ffc107 (진한 노란색)

### 구분선
- **섹션 구분**: 점선 (1px, #999)
- **헤더/푸터**: 실선 (2px, 검정)

## 주문 번호 관리

### 번호 부여 규칙
1. 주문이 접수될 때 히스토리에 저장됨
2. `localStorage`의 `yumyum_order_history`에서 당일 주문 목록 조회
3. 생성 시간(`createdAt`) 기준으로 정렬
4. 순서대로 1번부터 번호 부여

### 초기화 시점
- 매일 자정 이후 첫 주문부터 1번으로 시작
- 날짜(`toDateString()`) 비교로 당일 여부 확인

## 출력 기능

### 자동 출력
- 주문 접수 시 자동으로 영수증 출력
- 프린터 설정에서 "자동 출력" ON 시에만 작동
- 출력 성공 시 `receiptPrinted: true` 플래그 설정

### 수동 출력
1. **영수증 출력** 버튼
   - 선택된 주문의 영수증을 프린터로 출력
   - 프린터 설정 필요

2. **미리보기** 버튼
   - 새 창에서 영수증 미리보기
   - 브라우저 인쇄 기능 사용 가능

## 데이터 흐름

```
주문 생성 → 주문 접수 → 히스토리 저장 → 주문 번호 부여 → 영수증 생성 → 출력
```

## 파일 구조

### print-helper.js
- `maskPhoneNumber()`: 전화번호 마스킹
- `getTodayOrderNumber()`: 당일 주문 번호 조회
- `calculateExpectedTime()`: 예상 완료시간 계산
- `formatTimeWithSeconds()`: 시간 포맷 (초 포함)
- `formatDate()`: 날짜 포맷
- `convertOrderToReceiptData()`: 주문 데이터 변환
- `generateReceiptHTML()`: 영수증 HTML 생성
- `previewReceipt()`: 영수증 미리보기
- `printOrderReceipt()`: 영수증 출력
- `autoPrintReceipt()`: 자동 영수증 출력

### order-management.js
- `saveOrderToHistory()`: 주문 히스토리 저장
- `printCurrentReceipt()`: 현재 주문 영수증 출력
- `previewCurrentReceipt()`: 현재 주문 영수증 미리보기

## 샘플 출력물

```
════════════════════════════════
         냠냠픽업
════════════════════════════════

    주문번호: 21

────────────────────────────────
주문일자: 2025-10-30
주문시간: 08:43:42
────────────────────────────────

고객 정보
고객명: 홍길동
연락처: 010-****-5678
주문유형: 포장

────────────────────────────────
주문 메뉴
아메리카노 (L)    x1      4,000원
────────────────────────────────

요청사항
지금 바로 빨으러 갈게요

┌──────────────────────────────┐
│  예상 완료시간: 08:58:42     │
└──────────────────────────────┘

════════════════════════════════
합계                    4,000원
════════════════════════════════

   홍길동님 냠냠픽업을 
   주문해주셔서 감사합니다

```

## 에러 처리

### 프린터 미설정
- 메시지: "프린터가 설정되지 않았습니다. 설정 화면에서 프린터를 선택해주세요."

### 주문 미선택
- 메시지: "출력할 주문을 선택해주세요"

### 출력 실패
- 메시지: "영수증 출력에 실패했습니다: {오류 메시지}"

## 브라우저 호환성
- Chrome/Edge: 완전 지원
- Safari: 완전 지원
- Firefox: 완전 지원
- Electron: 완전 지원 (권장)

